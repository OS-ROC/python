# 多线程编程

## 学习目标

1. 了解什么是进程、线程
2. 了解什么是并行执行
3. 掌握使用threading模块完成多线程编程

------

## 进程和线程

### 什么是进程？

现代操作系统（如Mac OS X, UNIX, Linux, Windows等）都是支持“多任务”的操作系统。
**进程**：就是一个程序，运行在系统之上，那么便称之这个程序为一个运行进程，并分配进程ID方便系统管理。

### 什么是线程？

**线程**：线程是归属于进程的，一个进程可以开启多个线程，执行不同的工作，是进程的实际工作最小单位。

### 类比说明

- 进程就好比一家公司，是操作系统对程序进行运行管理的单位
- 线程就好比公司的员工，进程可以有多个线程（员工），是进程实际的工作者

### 内存隔离与共享

**注意点**：

- 进程之间是内存隔离的，即不同的进程拥有各自的内存空间。这就类似于不同的公司拥有不同的办公场所。
- 线程之间是内存共享的，线程是属于进程的，一个进程内的多个线程之间是共享这个进程所拥有的内存空间的。这就好比，公司员工之间是共享公司的办公场所。

**图示**：

text

```
┌─────────────────────────────────────┐
│           进程A                      │
│  ┌─────┬─────┬─────┐                │
│  │线程1│线程2│线程3│   内存共享      │
│  └─────┴─────┴─────┘                │
└─────────────────────────────────────┘
              │
              │ 内存隔离
              │
┌─────────────────────────────────────┐
│           进程B                      │
│  ┌─────┬─────┬─────┐                │
│  │线程1│线程2│线程3│   内存共享      │
│  └─────┴─────┴─────┘                │
└─────────────────────────────────────┘
```



### 运行模式

- 操作系统中可以运行多个进程，即多任务运行
- 一个进程内可以运行多个线程，即多线程运行

------

## 并行执行

### 什么是并行执行？

同一时间做不同的工作，称之为并行执行。

- 进程之间就是并行执行的，操作系统可以同时运行好多程序，这些程序都是在并行执行。
- 除了进程外，线程其实也是可以并行执行的。

例如一个Python程序，完全可以做到：

- 一个线程在输出：你好
- 一个线程在输出：Hello

像这样一个程序在同一时间做两件乃至多件不同的事情，我们就称之为：**多线程并行执行**。

------

## 使用threading模块进行多线程编程

绝大多数编程语言都允许多线程编程，Python也不例外。Python的多线程可以通过`threading`模块来实现。

### 创建线程对象

python

```
import threading

thread_obj = threading.Thread([group [, target [, name [, args [, kwargs]]]]])
```



**参数说明**：

- `group`: 暂时无用，未来功能的预留参数
- `target`: 执行的目标任务名
- `args`: 以元组的方式给执行任务传参
- `kwargs`: 以字典方式给执行任务传参
- `name`: 线程名，一般不用设置

### 启动线程

python

```
thread_obj.start()  # 启动线程，让线程开始工作
```



------

## 多线程编程示例

### 示例1：无参数传递

python

```
import threading
import time

def sing():
    while True:
        print("我在唱歌，啦啦啦...")
        time.sleep(1)

def dance():
    while True:
        print("我在跳舞，哗哗哗哗哗")
        time.sleep(1)

# 创建线程对象
sing_thread = threading.Thread(target=sing)
dance_thread = threading.Thread(target=dance)

# 启动线程
sing_thread.start()
dance_thread.start()
```



### 示例2：有参数传递

python

```
def sing():
    while True:
        print("我在唱歌，啦啦啦...")
        time.sleep(1)

def dance(msg):
    while True:
        print(msg)
        time.sleep(1)

# 通过args参数以元组形式传参（按参数顺序）
sing_thread = threading.Thread(target=sing)
dance_thread = threading.Thread(target=dance, args=("我在跳舞，哈哈哈",))

# 或通过kwargs参数以字典形式传参
# dance_thread = threading.Thread(target=dance, kwargs={"msg": "我在跳舞，哈哈哈"})

sing_thread.start()
dance_thread.start()
```



### 示例3：完整演示代码

python

```
import time
import threading

def sing(msg):
    while True:
        print(msg)
        time.sleep(1)

def dance(msg):
    while True:
        print(msg)
        time.sleep(1)

if __name__ == '__main__':
    # 创建一个唱歌的线程
    sing_thread = threading.Thread(target=sing, args=("我要唱歌 哈哈哈...",))
    # 创建一个跳舞的线程
    dance_thread = threading.Thread(target=dance, kwargs={"msg": "我在跳舞 啦啦啦..."})

    # 让线程开始工作
    sing_thread.start()
    dance_thread.start()
```



**传参方式**：

- `args`参数通过元组（按参数顺序）的方式传参
- 或使用`kwargs`参数用字典的形式传参

------

## 总结

### 1. 什么是进程？

程序在操作系统内运行，即成为一个运行进程。

### 2. 什么是线程？

进程内部可以有多个线程，程序的运行本质上就是由进程内部的线程在实际工作的。

### 3. 什么是并行执行？

- 多个进程同时在运行，即不同的程序同时运行，称之为：**多任务并行执行**
- 一个进程内的多个线程同时在运行，称之为：**多线程并行执行**

### 4. threading模块的使用

python

```
thread_obj = threading.Thread(target=func)  # 创建线程对象
thread_obj.start()  # 启动线程执行
```



### 5. 如何传参？

python

```
# 使用args传参
thread = threading.Thread(target=func, args=(param1, param2))

# 使用kwargs传参
thread = threading.Thread(target=func, kwargs={"param1": value1, "param2": value2})
```