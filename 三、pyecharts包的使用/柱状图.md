# Pyecharts 动态柱状图开发

## 目录
- 基础柱状图
- 基础时间线柱状图
- GDP动态柱状图绘制

## 学习目标

1. 掌握构建一个基础的柱状图并能够反转x和y轴  
2. 掌握基础的时间线配置动态图表  
3. 掌握设置主题更改颜色样式  
4. 掌握列表的sort方法并配合lambda匿名函数完成列表排序  
5. 完成图表所需的数据处理  
6. 完成GDP动态图表绘制

## 一、通过Bar构建基础柱状图

```python
from pyecharts.charts import Bar
from pyecharts.options import *

# 构建柱状图对象
bar = Bar()

# 添加x轴数据
bar.add_xaxis(["中国", "美国", "英国"])

# 添加y轴数据
bar.add_yaxis("GDP", [30, 20, 10])

# 反转x和y轴（变成横向柱状图）
bar.reversal_axis()

# 设置数值标签在右侧显示
bar.add_yaxis("GDP", [30, 20, 10], 
              label_opts=LabelOpts(position="right"))

# 渲染
bar.render("基础柱状图.html")
```

### 总结关键点

- 通过 `Bar()` 构建一个柱状图对象  
- 和折线图一样，通过 `add_xaxis()` 和 `add_yaxis()` 添加x和y轴数据  
- 通过柱状图对象的 `.reversal_axis()`，反转x和y轴  
- 通过 `label_opts=LabelOpts(position="right")` 设置数值标签在右侧显示

## 二、创建时间线（Timeline）
### 什么是时间线？

柱状图描述的是分类数据，回答的是“有多少？”这个问题。  
它是柱状图的主要特点，同时柱状图很难动态地描述一个趋势性的数据，  
这里 pyecharts 为我们提供了一种解决方案——**时间线**。

> 如果说一个 Bar + 一个 Line 对象就是一个图表的话，  
> 时间线就是创建一个“二维的x轴”，轴上每一个点就是一个图表对象。
```Python
from pyecharts.charts import Bar, Timeline
from pyecharts.options import *
from pyecharts.globals import ThemeType

# 示例：创建两个不同数据的Bar
bar1 = Bar()
bar1.add_xaxis(["中国","美国","英国"])
bar1.add_yaxis("GDP", [30, 20, 10], label_opts=LabelOpts(position="right"))
bar1.reversal_axis()

bar2 = Bar()
bar2.add_xaxis(["中国","美国","英国"])
bar2.add_yaxis("GDP", [50, 30, 20], label_opts=LabelOpts(position="right"))
bar2.reversal_axis()

# 创建时间线对象
timeline = Timeline()

# 添加图表到时间线
timeline.add(bar1, "2021年GDP")
timeline.add(bar2, "2022年GDP")

# 自动播放设置
timeline.add_schema(
    play_interval=1000,      # 自动播放时间间隔，单位毫秒
    is_auto_play=True,       # 是否自动播放
    is_loop_play=True,       # 是否循环播放
    is_timeline_show=True    # 是否显示时间线
)

timeline.render("基础柱状图-时间线.html")
时间线设置主题
Pythontimeline = Timeline({"theme": ThemeType.LIGHT})
# 常用主题：WHITE / LIGHT / DARK / CHALK / ESSOS / INFOGRAPHIC / MACARONS / PURPLE_PASSION / ROMA / ROMANTIC等
```
## 三、列表的 sort 方法进阶
```Python
# 带名函数形式
def choose_sort_key(element):
    return element[1]

my_list = [["a", 33], ["b", 55], ["c", 11]]
my_list.sort(key=choose_sort_key, reverse=True)
print(my_list)  
# → [['b', 55], ['a', 33], ['c', 11]]

# 匿名lambda形式（推荐！）
my_list = [["a", 33], ["b", 55], ["c", 11]]
my_list.sort(key=lambda element: element[1], reverse=True)
print(my_list)  
# 结果→ [['b', 55], ['a', 33], ['c', 11]]
```
## 四、完整案例：1960-2019全球前8国家GDP动态排名赛
```Python
"""
GDP动态柱状图开发
"""

from pyecharts.charts import Bar,Timeline
from pyecharts.options import *
from pyecharts.globals import ThemeType

# 读取数据
f = open(r"D:\数据分析\课件资料\资料\第1-12章资料\资料\资料\可视化案例数据\动态柱状图数据\1960-2019全球GDP数据.csv","r",encoding="GB2312")
data_lines = f.readlines()
# 关闭文件
f.close()
#d删除第一条数据
data_lines.pop(0)
# 将数据转换为字典存储，格式为：
# {年份：[[国家,gdp],[国家,gdp],......],[国家,gdp],[国家,gdp],......],......}
# {1960：[[美国,123],[中国,321],......],1961：[[美国,123],[中国,321],......],......}
# 先定义一个字典对象
data_dict = dict()
for line in data_lines:
    year = int(line.split(",")[0])     # 年份
    country = line.split(",")[1]       # 国家
    gdp = float(line.split(",")[2])    # GDP数据
    # 判断字典里面有没有指定的key
    try:
        data_dict[year].append([country,gdp])
    except KeyError:
        data_dict[year] = []
        data_dict[year].append([country,gdp])
# 创建时间线对象
timeline = Timeline({"theme":ThemeType.LIGHT})
sorted_year_list = sorted(data_dict.keys())
for year in sorted_year_list:
    data_dict[year].sort(key=lambda element:element[1],reverse=True)
    # 取出本年份前8名的国家
    year_data = data_dict[year][0:8]
    x_data = []
    y_data = []
    for country_gdp in year_data:
        x_data.append(country_gdp[0])   # x轴添加国家
        y_data.append(country_gdp[1] / 100000000)   # y轴添加gdp数据

    # 构建柱状图
    bar = Bar()
    x_data.reverse()
    y_data.reverse()
    bar.add_xaxis(x_data)
    bar.add_yaxis("GDP(亿)",y_data,label_opts=LabelOpts(
        position="right"
    ))
    # 反转x轴和y轴
    bar.reversal_axis()
    # 设置每一年图标的标题
    bar.set_global_opts(
        title_opts=TitleOpts(title=f"{year}年全球前八GDP数据")
    )
    timeline.add(bar,str(year))
# for循环每一年的数据，基于每一年的数据，创建每一年的bar对象
# 在for中，将每一年的bar对象添加到时间线中

# 设置时间线
timeline.add_schema(
    play_interval=700,      # 播放速度，单位为ms
    is_loop_play=False,     # 是否循环播放
    is_auto_play=True,      # 是否自动播放
    is_timeline_show=True  # 播放时是否显示时间线
)
# 绘图
timeline.render("1960-2019全球前八GDP数据.html")





```

