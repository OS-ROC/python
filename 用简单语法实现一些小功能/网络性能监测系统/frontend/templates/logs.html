{% extends "base.html" %}
{% block content %}

<style>
body {
    background-image: url('https://images.unsplash.com/photo-1762199715541-a42f25f48ecf?q=80&w=1475&auto=format&fit=crop');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

.logs-wrapper {
    background-color: rgba(255,255,255,0.75);
    backdrop-filter: blur(8px);
    border-radius: 12px;
    padding: 25px;
}

.table th {
    white-space: nowrap;
}

.pagination-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
}

.page-numbers {
    display: flex;
    justify-content: center;
    gap: 5px;
}

.range-buttons {
    margin-bottom: 20px;
    display: flex;
    gap: 10px;
}

.range-buttons a {
    text-decoration: none;
}
</style>

<div class="logs-wrapper">
    <h2 class="mb-4">ğŸ“„ ç³»ç»Ÿæ—¥å¿—</h2>

    <!-- æ—¶é—´åŒºé—´é€‰æ‹© -->
    <div class="range-buttons">
        <a href="?range=1h" class="btn btn-sm btn-outline-primary {% if current_range=='1h' %}active{% endif %}">æœ€è¿‘ 1 å°æ—¶</a>
        <a href="?range=24h" class="btn btn-sm btn-outline-primary {% if current_range=='24h' %}active{% endif %}">æœ€è¿‘ 24 å°æ—¶</a>
        <a href="?range=7d" class="btn btn-sm btn-outline-primary {% if current_range=='7d' %}active{% endif %}">æœ€è¿‘ 7 å¤©</a>
        <a href="?range=30d" class="btn btn-sm btn-outline-primary {% if current_range=='30d' %}active{% endif %}">æœ€è¿‘ 30 å¤©</a>
    </div>

    <div class="table-responsive">

        <div class="mb-3 text-end">
    <a href="/logs/download?range={{ current_range }}" class="btn btn-primary">
        â¬‡ï¸ ä¸‹è½½ JSON æ—¥å¿—
    </a>
</div>


        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>IP / Host</th>
                    <th>å»¶è¿Ÿ (ms)</th>
                    <th>ä¸¢åŒ…ç‡ (%)</th>
                    <th>HTTP å“åº” (ms)</th>
                    <th>è®°å½•æ—¶é—´</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.id }}</td>
                    <td>{{ log.host }}</td>
                    <td>{{ log.latency_ms }}</td>
                    <td>{{ log.packet_loss_percent }}</td>
                    <td>{{ log.http_response_ms }}</td>
                    <td>{{ log.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</td>
                </tr>
                {% endfor %}
                {% if logs|length == 0 %}
                <tr>
                    <td colspan="6" class="text-center text-muted">æš‚æ— æ—¥å¿—æ•°æ®</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination-wrapper">
        <!-- ä¸Šä¸€é¡µå›ºå®šå·¦è¾¹ -->
        <div>
            <a class="btn btn-outline-secondary {% if current_page <= 1 %}disabled{% endif %}" href="?range={{ current_range }}&page={{ current_page - 1 }}">ä¸Šä¸€é¡µ</a>
        </div>

        <!-- ä¸­é—´é¡µç  -->
        <div class="page-numbers">
            {% set start_page = current_page - 2 if current_page - 2 > 1 else 1 %}
            {% set end_page = current_page + 2 if current_page + 2 < total_pages else total_pages %}

            {% if start_page > 1 %}
                <a class="btn btn-sm btn-outline-primary" href="?range={{ current_range }}&page=1">1</a>
                {% if start_page > 2 %}
                    <span class="btn btn-sm disabled">â€¦</span>
                {% endif %}
            {% endif %}

            {% for p in range(start_page, end_page + 1) %}
                <a class="btn btn-sm btn-outline-primary {% if p == current_page %}active{% endif %}" href="?range={{ current_range }}&page={{ p }}">{{ p }}</a>
            {% endfor %}

            {% if end_page < total_pages %}
                {% if end_page < total_pages - 1 %}
                    <span class="btn btn-sm disabled">â€¦</span>
                {% endif %}
                <a class="btn btn-sm btn-outline-primary" href="?range={{ current_range }}&page={{ total_pages }}">{{ total_pages }}</a>
            {% endif %}
        </div>

        <!-- ä¸‹ä¸€é¡µå›ºå®šå³è¾¹ -->
        <div>
            <a class="btn btn-outline-secondary {% if current_page >= total_pages %}disabled{% endif %}" href="?range={{ current_range }}&page={{ current_page + 1 }}">ä¸‹ä¸€é¡µ</a>
        </div>
    </div>

    <!-- è·³è½¬é¡µç  -->
    <div class="mt-3 d-flex justify-content-center">
        <form class="d-flex gap-2" method="get" action="">
            <input type="hidden" name="range" value="{{ current_range }}">
            <input type="number" min="1" max="{{ total_pages }}" name="page" class="form-control" style="width:80px" placeholder="é¡µç ">
            <button type="submit" class="btn btn-primary">è·³è½¬</button>
        </form>
    </div>

</div>

{% endblock %}
